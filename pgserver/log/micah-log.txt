---- Friday, February 16

Found something interesting... in uClinux the menuitem widgets are actually
terminal widgets! After complaining a bit, opening a popup menu reveals
little terminal widgets. This is probably also why the canvas isn't working,
maybe there's a mistake in the function table for the widgets.

Wrote a working svgalib input driver for mouse and keyboard
+ apps/pgremote/svgainput.c

---- Thursday, February 15

Wrote the help file for menuconfig, config.help
+ config.help

Modified makefile and video drivers to skip the file if the video driver
is compiled in. This speeds up compilation a bit.

Adding video driver test modes (Pascal's suggestion :)
+ debug/videotest.c

Changed copyright messages for the new milennium...
(affects nearly every file)

---- Wednesday, February 14

Brandon informed me that pgBind is crufty, and so I add support for
rebinding and unbinding things and it now works just as client_c.h says it
will.

I need to write some real docs, especially for the client lib...

To fix tiled blits (and for a nice background) I put together a simple
background theme using the nifty tile from Propaganda
+ themetools/examples/bg_graywaves.ths

Fixed tiled blits in the old sdl driver and linear8

---- Tuesday, February 13

There's something wrong with the tile blits... (in all video drivers?)

Anyway, wrote a remote input driver (mouse only) for gpm
+ apps/pgremote/gpmremote.c

Replaced the Makefile.cfg system with a nifty one using Menuconfig (from
Linux)

---- Monday, February 12

To reduce the size of pgserver and make it better suited for low-bpp
displays, I replaced the hand cursor (that took about 4k in the binary) with
a tiny XBM cursor that takes practically no space.
I will be adding theme support to the cursor so the hand cursor can be
reborn as a theme.

---- Weekend, February 10-11

Posted pictures of the uCsimm and PicoGUI on the web page. The linear4
driver has working line, pixel, rectangle, and blit functions

---- Friday, February 9

Updated pgremote to have proper keyboard support, and work with SDL.
Not perfect, but almost completely functional.

Starting the linear4 driver!

---- Thursday, February 8

Since there's no input device on my ucSimm presently, I'm adding client-side
support for networked input devices.

Got a remote control working that lets me work the mouse and keyboard from
a networked computer!

---- Wednesday, February 7

Ack. That ucLinux stuff I put in CVS _was_ mostly right except that I forgot
a break; after the 8bpp case in  the pnm image loader...

I need to get NFS and m68k-gcc installed on this laptop! The ucSimm system
turns out to be nicely portable.

The bug in themec turned out to be a strategically-placed-missing-semicolon :-/

Working on ucLinux port using the new hardware...
Kludged together a driver using linear8. Pixels are reminiscent of Atari,
but it gets me an entire 160x200 at a good speed.

A few problems with the port so far:

- Word alignment. I think i fixed most of this, and the theme loader no
longer crashes, but it doesn't work right either.

- Driver, of course!

- Canvas widget and terminal are broke

- Need to implement a custom heap-management system. ucLinux's memory
mapping is slow and seems to leak quite a bit. Total memory as reported by
ps starts out at a reasonable 53k but can grow to over 600k after running
and closing many things. Still, pgserver running the demo app takes less
memory than the shell!

---- Tuesday, February 6

Added support for font descriptors in the theme compiler. Now a line of the
form:
font = Font("name",15,PG_FSTYLE_BOLD);
can be used just like pgNewFont to create font handles for themes.

Hmm... still something odd about the font stuff in themec. Sometimes it
corrupts other data. Need fix it...

---- Monday, February 5

Added client-side code for registering and unregistering as the owner of
shared resources. So far this encompasses exclusive keyboard/mouse control
and 'system events'

The system events are what I'm interested in, as that (for now) means the
background click event. This is crucial for setting up a launcher based on
a "root menu" with optional toolbar and launching panel. (get the best of
all three worlds :)

Starting a real launcher app, pgl
+ apps/pgl
+ apps/pgl/main.c
+ apps/pgl/Makefile

Nifty! background click menu works nicely!

In order to do custom menus correctly, added pgSizeText to client library

Adding a simple theme for monochrome LCDs
+ themetools/examples/lcdmono.ths

Got my 320x200 LCD and ucsimm working together! Just need to fix a bug in
the LCD power supply and figure out why so much percussive maintenance is
necessary :)

---- Friday and weekend, February 2 - 4

Almost finished building a second development machine using the ucSimm and
320x200 LCD. It works, but needs better mounting and I need to make a kernel
image for it.
The -25V power supply made with a MAX717 isn't the most efficient (because I
didn't have good inductors handy) but it works.


---- Thursday, February 1

Finished updating the client code for pgEvent.
Turns out some casual changes I made in the client code (changing a couple
small malloc() calls to alloca()) reveals a memory corruption bug in
pgMenuFromString. Also found an logic error that sometimes prevented
setwidget from having any effect.

It's ready to put on CVS now, hope this big change doesn't aggrivate people
(myself included) too much but I think it's for the best.

---- Wednesday, January 31

Brandon seems to be good at finding things I overlook :)
On his request I added a much-needed 'extra' pointer for passing arbitrary
data to event handlers.

Since an extra parameter to the events would break things anyway, (and at
this stage I'm much more interested in making a clean interface than
preserving compatibility with old junk) I did a small overhaul of the
client's event processing. Now the client lib decodes event parameters,
(using the new EVENTCODING constants) and packages it into a neat little
pgEvent structure.

Yay, today the ucSimm came in! Thank you Pascal!

Pascal gave me a pointer to Smartdata's neat project for expanding and
porting Waba. Also suggested a fourth option (in that list below) as making
a wrapper that emulates a subset of the AWT, to run small 'normal java' apps.

---- Tuesday, January 30

I was just taking a look through the Wabasoft web site. Unfortunately, the
iMacs here have no floppy disks so I have to wait till I get home to peruse
the source code, but this is looking very cool. Looks like there will be
three methods of developing client programs for PicoGUI

1. C, using the cli_C client library
2. Java, using the WabaVM and a Waba version of the native PicoGUI client API
3. Java, using the WabaVM and an emulation of waba's UI classes

Since the Waba classes have sockets it would be possible to write the entire
client lib in Java, but it's probably worth adding code to the VM itself to
speed it all up. Option 1 gives the best performance and flexibility but
limited portability, option 2 gives good portability (any platform running
PicoGUI) and flexibility but limits you to apps made specifically for
PicoGUI, and option 3 limits flexibility somewhat but lets you run apps
designed for the Palm or Windows CE devices too! This is pretty neat!

In fact, if all clients were written in Java and some sort of multitasking
could be added to the VM itself, it would indeed by _possible_ to integrate
Waba and pgserver into one binary and go without an operating system at
all... replacing ucLinux with a bare-bones filesystem and memory manager.
This seems closer to what the Kaffe and PocketLinux projects are working on,
but this would run on CPUs less than 75mhz ;-)

But, of course, that's an extreme. Though it is possible...

Now working on fixing that annoying "disappearing terminal" bug. Oddly
enough, seems to work right when debugging is on :)
It's not specifically a PicoGUI bug, it's an IPC thing. The child process is
dying before it sucessfully exec()'s the shell.

Ah... With the clean6 font I added yesterday I can get 125x75 on my laptop's
640x480 screen!

Fixed the terminal. Root cause of it all was I was using the return value of
read() to determine when the shell exits instead of using SIGCHLD like I'm
supposed to. Also fixed a bug in the resizing. (both client and server side)

Terminal still needs command line switches to change font, or run an
alternate program.

Added the above mentioned command line options, plus one to pause on exit
(ignore SIGCHLD)

---- Monday, January 29

Yay! I found the handle bug! After adding tons of debuggative cruft to
handle.c and wading through the log files, it hit me!

This is the scenario:

1. An auxiliary handle for a theme is created. A fillstyle, for example.
2. That handle is grouped with the theme's handle
3. The theme is forced to relocate to another node by htree_delete
4. The group pointer on the fillstyle is invalid
5. Another handle is allocated in its place eventually
6. That new handle is deleted, triggering a group delete of the fillstyle or
   other auxiliary data
   
This can be very simply solved by making the handlenode "personality
transplant" code update group pointers.
I'll change this on a fresh copy of the code- i added so many debugging
#ifdefs to handle.c that I'll look through the diff but probably just delete
it all.

This relocating behavior might be a bit troublesome for my idea of a "null
handle" system for ucLinux. Since ucLinux has no real memory protection
anyway, it couldn't hurt just to let the app have a pointer to the
handlenode. You still need the nodes themselves for memory management. I
suppose that in this situation I will need to store the nodes in a linked
list instead of the htree.

A few more things come to me... After a quick grep, I made sure no code
directly uses the group pointer but handle.c. This means it's impossible
that this bug could cause the ucLinux wierdness, but it does mean that I can
fix this whole mess by using a handle ID instead of a pointer. I'm not sure
why I used a pointer in the first place, maybe I thought I might have to use
the handle's data rather than just compare it.

The handle verification really should have picked up on this, but now that I
understand my false assumption-- a particular pointer will always be the
same handle-- I realize that my verification code had the same problem!

Yep, the only changes I made in this copy were setting freed memory to a known
value and the handle verification, niether of which are important or useful
now. I'm reverting my code to the CVS...

Added the above fix to handle.[ch] and it works great! The little torture-test
program ("Dialog box of doom!") that would always crash now runs to infinity
and beyond!

---- Friday and weekend, January 26-28

Working on the ucLinux port. Got NFS set up on Kiwi with a 115k PPP link.
Better than the 9600 baud connection, but I can't wait for ethernet :)

PicoGUI runs on ucLinux, but has intermittant problems I think are related
to memory segments. (bss vs data vs text) Hacked together a quick LCD driver
for Kiwi, display works! Theme loader always crashes, so haven't experimented
with themes and fonts made for tiny screens.

---- Thursday, January 25

Trying the handle test framework again...
Added the debug flag DEBUG_HANDLEVERIFY, that implements a linked list to
'check up on' the htree.

With the guru events and handle verification on, still no errors when the
handle tree goes dead.
On the bright side, with all debugging commands on I used grep to pinpoint
the spot when extra memory is freed. Looks like a problem with contexts-
when the dialog box context is freed (normally deleting only widgets and a
string) it spontaneously deleted a few fillstyles!
This is easy to detect because the memory counters drop lower than they would
normally.
Now to take those addresses and do a stack backtrace or something...

---- Tuesday, January 23

Taking a little diversion to do canvas event handling. Starting the
"Blackout" application to test this.

+ apps/blackout
+ apps/blackout/blackout.c
+ apps/blackout/Makefile

Blackout is working nicely.
I think I'll try something a little more complicated and a lot more
nostalgic and try to port BrickHit to PicoGUI! (BrickHit is an old
pong/breakout style game I wrote in True BASIC when I was little :) I don't
remember the exact scoring rules, but it should be close enough.

+ apps/brickhit
+ apps/brickhit/brickhit.c
+ apps/brickhit/Makefile

Oops, my 'make clean' accidentaly deleted the debug directory before I had a
chance to commit it...
Well, it wasn't working right anyway. I need to write something that deletes
and adds completely randomly (but keeps the tree size within some limits)

---- Monday, January 22

This morning Pascal offered to give me a ucSimm they never use. I think I'll
take him up on that!

Starting a test framework for the handle system

+ debug
+ debug/handletest.c
+ debug/Makefile

---- Friday and weekend, January 19-21

Got canvas working for animation!
Still have a race condition in the client library, and that handle bug.
It's on CVS, but I forgot to do a cvs update on Trinity...

I'm itching to do the 68EZ328 port. Kiwi is hooked up and pingable, but I
can only get serial line speeds so development work is painful.

---- Thursday, January 18

Added pgWriteCmd to client.
Starting test program for canvas widget:

+ demos/canvastest.c

---- Wednesday, January 17

Period today was cut short by english oral, but I finished a preliminary
picogui/canvas.h header. It's mainly documentation- there are only 16 lines
or so of actual code.

Working on client side:
+ include/picogui/canvas.h

---- Tuesday, January 16

Starting the canvas widget!
+ widget/canvas.c

Adding a header file with command structures
+ include/picogui/canvas.h

---- Weekend, January 13-15

More video driver improvements, including the crazy ncurses driver.
Made some web updates and sent a status newsletter on the mailing list.

---- Friday, January 12

Happy Friday!

Just got paged blits working. linear8 runs nicely on my VESA 1.2 laptop
screen now though it's not as fast as the unstable vgagl driver. (paged
framebuffers force doublebuffering on)
Replaced many for loops in linear8 with the inline-asm __mem* functions

Fixed a subtle but possibly disasterous error in handle.c; this could be the
source of the handle tree problems I've been having lately. There is one
special case in htree_delete() in which it must copy the 'identity' of a
handle node from one to another. When I added the 'group' field to the
handle node, I forgot to add a line to copy it. (I added a warning in
handle.h to this effect; hopefully this won't happen again.)
The outcome of all this is that a handle's group can be randomly reassigned
to another handle's group. When one handle is deleted, others might randomly
disappear. This is consistant with observed behavior.

I don't, however, think this is the only problem... Sometimes handles would
appear to swap pointers with each other, or do other strange things. <insert
sound of plane crash>
Unless I find something really obvious I'll make a testbed program I can use
to evaluate the handle functions seperately.

Yep, verified that handles still have problems.

Added a command line switch for double-buffering

Modified svgagl library to support runtime doublebuffering, and removed a
few archaic crufty bits.

---- Thursday, January 11

Using the paged blit from vgagl. Also converting existing code to use
inlined assembler string functions (memcpy et al) if possible.
+ pgserver/include/inlstring.h

---- Wednesday, January 10

Implementing paged double-buffer blits, so svgafb works on nonlinear devices
(like my 640x480 mode!)
Paged blit is only slightly functional so far, but it's started...

Added some simple but very effective optimizations to textgrid, like not
calling outchar for spaces!

---- Tuesday, January 9

Fixed bugs in linear8 driver and scrolling (grop.c)
Compiles under windows now but doesn't accept connections correctly

Today Brandon falls in love with the framebuffer device. If only I had Vesa
2.0 on Trinity!

---- Monday, January 8

video/linear8.c:
fixed small bugs in text blit, implemented clipping in the vertical text
blit. Still working on a very subtle bug in clipping x1 in the vertical blit.

Thank goodness for editor backups. *.c and *.o are so similar!

Brandon ran PicoGUI on his laptop for the first time. Notes:
	- sdl driver works, but exhibits odd
	  translucent artifacts around cursor
	- sdlfb driver works fine for the most part but colors are messed up
I think both of these are due to the window manager or X mapping my colors
strangely. Need to figure out how to get direct palette access

--- The / Beginning --- (of this log...) ---

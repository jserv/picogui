<html>
  <head>
    <title>Setting up your project for CIA commit monitoring</title>
  </head>

  <body>
    <h1>What is CIA?</h1>
    <p>CIA is a bot that will take email from your CVS/Subversion repositories' commit scripts, and output it to the
      #commits channel on freenode, and optionally to your project's IRC channel.
      It means you can sit in that channel and marvel in real time at all the free software
      being written all over the world.</p>

    <h1>How do I use it?</h1>

    <p>For CVS, firstly place this script somewhere on the server:</p>
    <code><pre>
	
#!/bin/bash
message=`cat`
uname=`id -un`
lineno=`echo "$message" | grep -n "Log Message:" | awk -F: ' { print $1 } '`
message=`echo "$message" | sed "1,${lineno}d"`
                                                                                                                                   
cat &lt;&lt;EOF | /usr/sbin/sendmail
From: commits@autopackage.org
To: commits@picogui.org
Content-Type: text/plain;
Subject: Announce channelname
                                                                                                                                   
cvs commit by $uname: $message
EOF

    </pre></code>

    <p> Then replace "channelname" with the name of your projects IRC channel. (Leave out the "#" in the channel name.) 
        That name will be prefixed to the output in the #commits channel as well. </p>

    <p> The script is very simple, customise it however you like. The code at the top strips out all the extra info CVS gives
        you, like which files are modified. It then puts the result in an email and sends it to the bot. It assumes you are using
        ssh authentication, otherwise the username will always return the same thing.</p>

    <p> Now check out the CVSROOT module of your projects repository, and in the loginfo file, place this line:</p>

    <code>
      ALL /path/to/script
    </code>

    <h1>Controlling the bot</h1>

    <p> You can make the bot join your channel by sending an email to commits@picogui.org with the subject "JoinChannel [channel]".
        (Leave out the "#" beginning the channel name) You can make it leave your channel by sending a mail with the subject
        "PartChannel [channel]". </p> The email body will be ignored.

    <h1> Does it work with subversion? </h1>

    <p> Yes, but writing a script to send the right email is left as an excercise to the reader (the script on picogui.org talks
      directly to the server via a socket, so don't try and copy it exactly) </p>

    <h1> Source code? </h1>

    <p>
     <a href="http://navi.picogui.org/svn/picogui/trunk/tools/irc/announceBot.py">The bot</a>, 
     <a href="http://navi.picogui.org/svn/picogui/trunk/tools/irc/emailBotClient.py">The email-based client</a>,
     <a href="http://navi.picogui.org/svn/picogui/trunk/tools/svn/hooks/announceClient.py">The local client</a>.
     It falls under the "who cares" license, do anything you like with it. </p>

    <h1> Who wrote this stuff? </h1>
    
    <p> That would be scanline (Micah Dowty), in #picogui. This page is written by TD (Mike Hearn) in #autopackage.</p>

    <h1> Why is it called CIA? </h1>

    <p> Joke from Lalo, CIA was originally written to monitor the PicoGUI subversion repository, so the bot is a
      brainless entity designed to monitor subversion. If you don't get it, forget it :) </p>

    <hr>
    <p>1st June 2003</p>
  </body>

</html>

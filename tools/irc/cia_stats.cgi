#!/usr/bin/env python
#
# Simple CGI script to generate a page with per-project
# message counts generated by the CIA bot.
#

import os
from cia_statreader import *

# Page heading
print """Content-type: text/html

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
  <title>CIA bot statistics</title>
  <style type="text/css" media="all"> @import url(http://navi.picogui.org/svn/picogui/trunk/tools/css/cia_stats.css);
  </style>
</head>
<body>

<div class="heading">
   <div class="title">CIA bot statistics</div>
   <div class="subtitle">Because SF stats weren't pointless enough</div>
</div>

<div><span class="section">Number of messages posted per project</span></div>
<div class="section">
  <div class="sectionTop"></div>
  <div class="row">
    <table>
"""

# Project table heading
print "<tr>",
for heading in ('project',) + statSubdirs:
    print '<th>%s</th>' % statHeadings[heading],
print "</tr>"

# Project table contents
for project in projects:
    print "<tr><td>%s</td>" % project,
    for subdir in statSubdirs:
        count = projectCounts[project][subdir]
        if count:
            print "<td>%s</td>" % count,
        else:
            print "<td></td>",
    print "</tr>"
    
print """

    </table>
  </div>
</div>

<div><span class="section">Channels the bot is currently in</span></div>
<div class="section">
  <div class="sectionTop"></div>
  <div class="row">
    <ul>
"""
for channel in channels:
    print "<li>%s</li>" % channel
print """
    </ul>
  </div>
</div>

</body>
</html>
"""
